
Contents:

1. Summary
2. Usage
3. Technical Descriptions
4. Known Issues
5. Useful Tools

===========================================

**SUMMARY**

Velocity scripts and Data Definitions to help facilitate the creation and addition of Google Maps into Cascade Server Pages.

===========================================

**USEAGE**

The Data Definitions are best used when attached to an XHTML/Data Definition Block asset. This is because each Format is written for that type of generated XML structure. The Block asset can be assigned to a `<system-region>`, at either the Template level or Configuration Set level. You will then assign the proper Format to the same `<system-region>` to style the XML generated by the Block's Data Definition.

You may choose to create Asset Factories for creating either type of Map Block, however you will need to temporarily make all of the Data Definition fields NOT REQUIRED in order to create the blank, base asset needed in the Asset Factory.

===========================================

**TECHNICAL DESCRIPTION**

This Google Map helper interfaces with both the Google Map [Static API](http://code.google.com/apis/maps/documentation/staticmaps/) and the [Javascript v3 API](http://code.google.com/apis/maps/documentation/javascript/reference.html).

There are two separate Data Definitions and Velocity scripts -- one for each API. The 'velocity-static' or 'xslt-static' Format is designed to pair with the 'dd-static' Data Definition. The 'velocity-js' or 'xslt-js' Format is designed to pair with the 'dd-js' Data Definition.


A. Static Map

The Data Definition for accessing the Static API has 10 map fields and 6 marker fields.

Map Fields

* HTML id - REQUIRED. This field is mapped to the 'id' attribute of an HTML `<div>` element that wraps the HTML `<img>` tag used to create the static map image.
* Map title - REQUIRED. This field is mapped to both the 'alt' and 'title' attributes of the HTML `<img>` tag used to create the static map image.
* Map width - REQUIRED. Desired width of the map image in pixels. You do not need to type 'px' or 'pixels' at the end. This field is expecting only integers 0-9 and a maximum of 4 characters. There is a regular expression attached to this field to require only numbers and at least 1 character being entered.
* Map height - REQUIRED. Desired height of the map image in pixels. You do not need to type 'px' or 'pixels' at the end. This field is expecting only integers 0-9 and a maximum of 4 characters. There is a regular expression attached to this field to require only numbers and at least 1 character being entered.
* Map center - Optional. A comma-separated latitude and longitude pair that defines the center of the map, equidistant from all edges. If no center is given, the Markers are used to determine the center of the map such that all Markers are visible and balanced.
* Zoom level - This determines the "resolution" of the image view. Available levels range from 0 to 20, with 0 showing the entire world and 20 showing an individual building.
* Image protocol - Allows for you to choose the HTTP or HTTPS protocol for use in the 'src' attribute of the `<img>` tag used to create the map image.
* Image format - There are several common web graphics formats. This field allows you to choose what image format you prefer.
* Map type - There are several map formats that can be selected. This field allows you to choose what type of map imagery will be used.
* Map language - This field defines the language used to display the labels on the map tiles. Not all of the available languages are supported for some country titles. If the language requested is not supported, then the default language for that tileset will be used.

Marker Fields

* Use - REQUIRED. This is a Cascade Server option that allows you to store Markers in Cascade but not display them on the map. Only Markers with a value of 'Yes' will be placed on the map.
* Size - This field specifies the size of marker used on the map.
* Color - This field specifies a predefined color for the marker used on the map.
* Label - REQUIRED. This field specifies a single UPPERCASE alphanumeric character used to list in the icon of the Marker. The 'normal' and 'mid' sized markers are the only ones capable of displaying the label. The 'tiny' and 'small' markers are not capable of displaying the label.
* Address - KIND OF REQUIRED. Each Marker needs either an address or a latitude/longitude pair. This field defines the Marker's location on the map image. If both the address and coordinates fields are filed out, the address will be used first. If neither fields are filed out, the Marker will be skipped.
* Coordinates - KIND OF REQUIRED. Each Marker needs either an address or a latitude/longitude pair. This field defines the Marker's location on the map image. If both the address and coordinates fields are filed out, the address will be used first. If neither fields are filed out, the Marker will be skipped.

When paired with the proper Format, the HTML end result should look something like this:

	<div id="map_canvas"><img alt="Hannon Hill Google Map" src="http://maps.google.com/maps/api/staticmap?zoom=13&amp;size=400x400&amp;format=png8&amp;maptype=${type}&amp;language=en&amp;markers=size:normal|color:orange|label:H|950 East Paces Ferry Rd, Atlanta, GA 30326&amp;sensor=false" title="Hannon Hill Google Map"/></div>

The Format for the Static API will traverse the XML generated by the 'dd-static' Data Definition and build the HTML structure, including the URL needed for the 'src' attribute of the map image.


B. Javascript Map

The Data Definition for accessing the Static API has 7 map fields and 4 marker fields.

Map Fields

* HTML id - REQUIRED. This field is mapped to the 'id' attribute of an HTML `<div>` element that wraps the HTML `<img>` tag used to create the static map image.
* Map title - REQUIRED. This field is mapped to the contents of an HTML `<div>` element that is transformed to contain the map image. If the map is unable to load, this text will be shown in the HTML `<div>` element.
* Map width - REQUIRED. Desired width of the map image in pixels. You do not need to type 'px' or 'pixels' at the end. This field is expecting only integers 0-9 and a maximum of 4 characters. There is a regular expression attached to this field to require only numbers and at least 1 character being entered.
* Map height - REQUIRED. Desired height of the map image in pixels. You do not need to type 'px' or 'pixels' at the end. This field is expecting only integers 0-9 and a maximum of 4 characters. There is a regular expression attached to this field to require only numbers and at least 1 character being entered.
* Map center - Optional. A comma-separated latitude and longitude pair that defines the center of the map, equidistant from all edges. If no center is given, the Markers are used to determine the center of the map such that all Markers are visible and balanced.
* Zoom level - This determines the "resolution" of the image view. Available levels range from 0 to 20, with 0 showing the entire world and 20 showing an individual building.
* Map type - There are several map formats that can be selected. This field allows you to choose what type of map imagery will be used.

Marker Fields

* Use - REQUIRED. This is a Cascade Server option that allows you to store Markers in Cascade but not display them on the map. Only Markers with a value of 'Yes' will be placed on the map.
* Marker title - REQUIRED. This field will be mapped to the 'title' attribute of the Javascript Marker object. It will be displayed as a tool tip for each Marker on the map.
* Coordinates - REQUIRED. Each Marker needs a latitude/longitude pair. This field defines the Marker's location on the map. It differs from the Static Map API where you have the option of specifying an address. See the Useful Tools section at the bottom of this document for helping you find the coordinates of your desired locations.
* InfoWindow content - REQUIRED. This field will be mapped to the 'html' attribute of the Javascript Marker object. It will be displayed when the Marker is clicked in the map. HTML content is currently supported in this text field.

When paired with the proper Format, the HTML end result should look something like this:

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript"></script>
	<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
	<script type="text/javascript">
		$(document).ready(function() { initialize(); });
		function initialize() {
			var map_options = {
				center: new google.maps.LatLng(33.84659,-84.35686),
				zoom: 12,
				mapTypeId: google.maps.MapTypeId.ROADMAP,
				streetViewControl: false,
				scrollwheel: false,
				draggable: true
			};
			
			var google_map = new google.maps.Map(document.getElementById("map_canvas"), map_options);
			
			var info_window = new google.maps.InfoWindow({
				content: 'loading'
			});
							
			var m1 = new google.maps.Marker({
				map:       google_map,
				animation: google.maps.Animation.DROP,
				title:     'Hannon Hill',
				position:  new google.maps.LatLng(33.84659, -84.35686),
				html:      'Hannon Hill<br/>950 E Paces Ferry Rd<br/>Atlanta, GA 30326'
			});
			
			google.maps.event.addListener(m1, 'click', function() {
				info_window.setContent(this.html);
				info_window.open(google_map, this);
			});
			
			var m2 = new google.maps.Marker({
				map:       google_map,
				animation: google.maps.Animation.DROP,
				title:     'Home',
				position:  new google.maps.LatLng(33.898724, -84.444452),
				html:      '<strong>Home</strong><br/>Atlanta, GA 30339'
			});
			
			google.maps.event.addListener(m2, 'click', function() {
				info_window.setContent(this.html);
				info_window.open(google_map, this);
			});
		}
	</script>
	<div id="map_canvas" style="width:240px;height:240px;">Hannon Hill Google Map</div>

The Format for the Javascript API will traverse the XML generated by the 'dd-js' Data Definition and build the HTML structure, including the Javascript code needed for the Map and Marker objects.

===========================================

**KNOWN ISSUES**

Currently the InfoWindow for each Marker Object DOES support HTML content. However, when providing a WYSIWYG field for the InfoWindow, any line breaks in the HTML source cause the Javascript to not be formatted properly. The text input field is used over the WYSIWYG in order to ensure that all HTML is on a single line of code when inserted into the 'html' attribute of the Marker object.

===========================================

**USEFUL TOOLS**

To help find the latitude/longitude coordinates of a location, you have three options. Option number 1 will most likely be the easiest for you.

* Google Maps Lab titled 'LatLng Marker' adds an option to the context menu that lets you drop a mini-marker showing the latlng of the position that the cursor was pointing at when the context menu was evoked. You can then simply highlight the coordinates and copy them into your clipboard for pasting into Cascade.
* Google Maps Lab title 'LatLng Tooltip' displays a tooltip next to the mouse cursor showing the latlng directly underneath it. Press SHIFT to activate tooltip. However, you are not able to select this text with your mouse. You will need to manually provide that information into Cascade.
* Javascript code to type in the address bar on your browser. Center a Google Map on your desired location and execute this Javascript code in the address bar of your browser to alert you to the coordinates: `javascript:void(prompt('',gApplication.getMap().getCenter()));`
